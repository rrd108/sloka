(function(t){function e(t){return-1!=t.search(/ének/i)||-1!=t.search(/līlā/i)||-1!=t.search(/fejezet/i)||-1!=t.search(/vers/i)||-1!=t.search(/\d+\./i)||-1!=t.search(/mantra/i)}function n(t,e,n){var a=e.partial?' data-partial="'+e.partial+'"':"";n=n==e.id?"selected ":"",t.append('<option value="'+e.id+'"'+n+a+">"+e.title+"</option>")}function a(e){var n=t("<div>"+e+"</div>"),a=n.find(".Uvaca").text()?n.find(".Uvaca").text()+"\n ":"";return a+=n.find(".Vers").html().replace(/<\/*i>/g,"").replace(/<br>/g,"\n"),a+="\n\n"+n.children(".Forditas").text(),a}function r(){O=O.replace(/<span class="unseen">/g,""),O=O.replace(/<\/span>/g,"")}function i(){for(var t,e=[],n=/[ \-\n ]/g;null!=(t=n.exec(O));)e.push(t.index);var a="",r=O.split(n),i=0;return{splitters:e,modifiedVerse:a,words:r,pos:i}}function o(t,e){t.modifiedVerse+=e+(O[t.splitters[t.pos]]?O[t.splitters[t.pos]]:""),t.pos++}function s(){r();var e=i();t.each(e.words,function(t,n){var a=parseInt(n.length/2),r=n.substr(0,a)+'<span class="unseen">'+n.substr(a,n.length-a)+"</span>";o(e,r)}),O=e.modifiedVerse}function l(){r();var e=i();t.each(e.words,function(t,n){var a=parseInt(n.length-1),r=n.substr(0,1)+'<span class="unseen">'+n.substr(1,a)+"</span>";o(e,r)}),O=e.modifiedVerse}function c(){1==I.step?r():2==I.step?s():3==I.step&&l(),u()}function u(){t("main").html(O.replace(/(?:\n)/g,"<br>"))}function d(t){-1==t.attr("src").search("filled")&&t.attr("src",t.attr("src").replace(".png","-filled.png"))}function f(t){t.attr("src",t.attr("src").replace("-filled",""))}function p(){for(var e,n="id"+t("#books").val(),a=2;a<5;a++)e=parseInt(t("#sel"+a).val()),e&&(n+="/id"+e);return n}function h(e){return{async:!1,url:R.tocGet+e,xhrFields:{withCredentials:!0},success:function(e){"expired"==e.error?(t("#login").show(),t("#app").hide()):e.id>=0&&(I["id"+e.id]=e,I["id"+e.id].path=p())},error:function(t){alert("Valami gáz van típusú hibába botlottam! (buildObjForTocGet)")}}}function g(t){var e=!1;return I["id"+t]&&I["id"+t].children&&(e=!0),e}function v(e){t.isNumeric(e)&&(e=[e]),t.each(e,function(e,n){select=t("#sel"+n),select.empty(),select.append("<option>--- válassz ---</option>"),select.hide()})}function m(){for(var e=t(this).val(),n=parseInt(t(this).attr("id").replace("sel",""))+1,r=[],i=n;i<N;i++)r.push(i);v(r),1==t(this).find(":selected").data("partial")?(I["id"+e]||t.ajax(h(e)),w(n,e)):I["id"+e]?(O=I["id"+e].text,I.lastVerse="id"+e,c(),y(I.lastVerse)):t.ajax({url:R.sectionGo+e,success:function(t){O=a(t.text),I["id"+e]={shortRef:t.shortRef,text:O,path:p()},I.lastVerse="id"+e,c(),y(I.lastVerse)},error:function(t){alert("Valami gáz van típusú hibába botlottam! (selectChangeHandler)")}})}function b(){void 0===t.localStorage("sloka.learnt")&&(localStorage.removeItem("sloka"),t.localStorage.remove("sloka")),I=t.localStorage("sloka")?t.localStorage("sloka"):{step:1,learnt:[]},t.ajax({async:!1,url:R.root,xhrFields:{withCredentials:!0},success:function(e){0==e.id&&(I.loggedin=!0,I.id0={id:0,children:[]},t.each(e.children,function(t,e){I.id0.children[t]={id:e.id,title:e.title,partial:!e.partial||e.partial}}),I.id1=e.children[0])},error:function(t){alert("Valami hiba történt")}})}function k(){t("nav img.steps").click(function(e){t("nav img.steps").each(function(){e.target==this?(I.step=t(this).attr("src").replace(".png","").replace("img/","").replace("-filled",""),d(t(this))):f(t(this))}),c()}),t("#save").click(function(){-1==I.learnt.indexOf(I.lastVerse)&&(I.learnt.push(I.lastVerse),C())}),t("#switch").click(function(){var e=t("main").html().replace("<br><br>","|").replace(/<br>/g," ").split("|"),n=[];t.each(e[0].split(" "),function(t,e){n.push(e.trim())}),shuffledVerse=n.sort(function(){return.5-Math.random()}),t("main").append('<div id="shuffledVerse">'+shuffledVerse.join(" ")+"</div>")}),t("#help").click(function(){t.ajax({url:R.help,success:function(e){t("main").empty().append(e)}})}),t("#logout").click(function(){t.ajax({url:R.logout,success:function(){window.location.href=R.sloka}})})}function x(){t("p").on("click","span",function(){t(this).removeClass("unseen"),t(this).delay(2e3).queue(function(){t(this).addClass("unseen")})})}function w(a,r,i){0!==r.search("id")&&(r="id"+r),t.each(I[r].children,function(r,o){e(o.title)&&n(t("#sel"+a),o,i)}),t("#sel"+a).show();for(var o=++a;o<N;o++)v(o)}function V(e){t("#books").empty();var n="";t.each(I.id0.children,function(t,a){n+='<option value="'+a.id+'"',-1==F.indexOf(a.id)&&(n+=" disabled"),e=="id"+a.id&&(n+=" selected"),n+=">"+a.title+"</option>"}),t("#books").append(n)}function j(){v([3,4]),t("#sel2").change(function(){m.call(this)}),t("#sel3").change(function(){m.call(this)}),t("#sel4").change(function(){m.call(this)})}function y(e){t("#shortref").text(I[e].shortRef)}function C(){if(I.learnt.length){var e=t("#removelearnt").hide().detach(),n=t("#footerhamburger").hide().detach();t("footer").empty().append(n.show()),t.each(I.learnt,function(e,n){t("footer").append('<span data-inventoryid="'+n+'">'+I[n].shortRef+"</a>")}),t("footer").append(e)}else t("footer").append("<span>Még nincs elmentett versed</span>")}function S(){t("footer").on("mouseover","span",function(){t(this).append(t("#removelearnt").show())}),t("footer").on("mouseout","span",function(){t("#removelearnt").hide()}),t("footer").click(function(e){var n;if("removelearnt"==t(e.target).attr("id")){n=t(e.target).parent().data("inventoryid");var a=t(e.target);t(e.target).parent().remove(),t("footer").append(a),I.learnt=t.grep(I.learnt,function(t){return t!=n})}else if("SPAN"==t(e.target).prop("tagName")){n=t(e.target).data("inventoryid");var r=z(n);c(),V(r)}else if("footerhamburger"==t(e.target).attr("id")){var i="21"==t("footer").height()?"auto":"21";t("footer").height(i)}})}function z(t){I.lastVerse=t,O=I[t].text,y(t);for(var e=I[t].path.split("/"),n=e[0],a=e.length-1,r=0;r<a;r++)v(r+2),w(r+2,e[r],e[r+1].replace("id",""));return n}function G(){t("#books").change(function(){v([2,3,4]);var e=t(this).find("option:selected").val();g(e)||t.ajax(h(e)),w(2,e)})}function A(){j(),k(),x(),d(t("#s"+I.step));var e="id1";I.lastVerse?e=z(I.lastVerse):w(2,e),c(),V(e),G(),C(),S()}var I={},R={},F=[1,729,11365,22894,22996],O="",N=4,T=!0;T?R={sloka:"",pandit:"",root:"testdata/pandit-toc-root.json",tocGet:"testdata/pandit-toc-get-response-",sectionGo:"testdata/pandit-section-go-response.json?",auth:"testdata/pandit-authenticate.json",expired:"testdata/pandit-expired.json",help:"help.html",logout:"testdata/pandit-auth-logout.json"}:(R.sloka="http://pandit.hu/sloka/",R.pandit="http://pandit.hu/app/",R.root=R.pandit+"toc/root",R.tocGet=R.pandit+"toc/get/",R.sectionGo=R.pandit+"txt/section/go/",R.auth=R.pandit+"auth/authenticate",R.help="help.html",R.logout=R.pandit+"auth/logout"),b(),t(function(){!0===I.loggedin?(t("#app").show(),A()):(t("#login").show(),t("#login > form").submit(function(e){e.preventDefault(),t.ajax({url:R.auth,method:"POST",dataType:"json",data:{email:t("#email").val(),password:window.md5(t("#password").val())},success:function(e){e.ok?(t("#login").hide(),b(),A(),t("#app").show()):e.fail?alert("Hibás bejelentkezési név vagy jelszó!"):e.message?alert(e.message):alert("A bejelentkezés során valamilyen mittudomén típusú hibára futottam!")},error:function(t){alert("Valami gáz van típusú hibába botlottam! (onReady)")}})}))}),t(window).on("unload",function(){I.loggedin=!1,t.localStorage("sloka",I)})})(jQuery),function(t){"use strict";function e(t,e){var n=(65535&t)+(65535&e),a=(t>>16)+(e>>16)+(n>>16);return a<<16|65535&n}function n(t,e){return t<<e|t>>>32-e}function a(t,a,r,i,o,s){return e(n(e(e(a,t),e(i,s)),o),r)}function r(t,e,n,r,i,o,s){return a(e&n|~e&r,t,e,i,o,s)}function i(t,e,n,r,i,o,s){return a(e&r|n&~r,t,e,i,o,s)}function o(t,e,n,r,i,o,s){return a(e^n^r,t,e,i,o,s)}function s(t,e,n,r,i,o,s){return a(n^(e|~r),t,e,i,o,s)}function l(t,n){t[n>>5]|=128<<n%32,t[14+(n+64>>>9<<4)]=n;var a,l,c,u,d,f=1732584193,p=-271733879,h=-1732584194,g=271733878;for(a=0;a<t.length;a+=16)l=f,c=p,u=h,d=g,f=r(f,p,h,g,t[a],7,-680876936),g=r(g,f,p,h,t[a+1],12,-389564586),h=r(h,g,f,p,t[a+2],17,606105819),p=r(p,h,g,f,t[a+3],22,-1044525330),f=r(f,p,h,g,t[a+4],7,-176418897),g=r(g,f,p,h,t[a+5],12,1200080426),h=r(h,g,f,p,t[a+6],17,-1473231341),p=r(p,h,g,f,t[a+7],22,-45705983),f=r(f,p,h,g,t[a+8],7,1770035416),g=r(g,f,p,h,t[a+9],12,-1958414417),h=r(h,g,f,p,t[a+10],17,-42063),p=r(p,h,g,f,t[a+11],22,-1990404162),f=r(f,p,h,g,t[a+12],7,1804603682),g=r(g,f,p,h,t[a+13],12,-40341101),h=r(h,g,f,p,t[a+14],17,-1502002290),p=r(p,h,g,f,t[a+15],22,1236535329),f=i(f,p,h,g,t[a+1],5,-165796510),g=i(g,f,p,h,t[a+6],9,-1069501632),h=i(h,g,f,p,t[a+11],14,643717713),p=i(p,h,g,f,t[a],20,-373897302),f=i(f,p,h,g,t[a+5],5,-701558691),g=i(g,f,p,h,t[a+10],9,38016083),h=i(h,g,f,p,t[a+15],14,-660478335),p=i(p,h,g,f,t[a+4],20,-405537848),f=i(f,p,h,g,t[a+9],5,568446438),g=i(g,f,p,h,t[a+14],9,-1019803690),h=i(h,g,f,p,t[a+3],14,-187363961),p=i(p,h,g,f,t[a+8],20,1163531501),f=i(f,p,h,g,t[a+13],5,-1444681467),g=i(g,f,p,h,t[a+2],9,-51403784),h=i(h,g,f,p,t[a+7],14,1735328473),p=i(p,h,g,f,t[a+12],20,-1926607734),f=o(f,p,h,g,t[a+5],4,-378558),g=o(g,f,p,h,t[a+8],11,-2022574463),h=o(h,g,f,p,t[a+11],16,1839030562),p=o(p,h,g,f,t[a+14],23,-35309556),f=o(f,p,h,g,t[a+1],4,-1530992060),g=o(g,f,p,h,t[a+4],11,1272893353),h=o(h,g,f,p,t[a+7],16,-155497632),p=o(p,h,g,f,t[a+10],23,-1094730640),f=o(f,p,h,g,t[a+13],4,681279174),g=o(g,f,p,h,t[a],11,-358537222),h=o(h,g,f,p,t[a+3],16,-722521979),p=o(p,h,g,f,t[a+6],23,76029189),f=o(f,p,h,g,t[a+9],4,-640364487),g=o(g,f,p,h,t[a+12],11,-421815835),h=o(h,g,f,p,t[a+15],16,530742520),p=o(p,h,g,f,t[a+2],23,-995338651),f=s(f,p,h,g,t[a],6,-198630844),g=s(g,f,p,h,t[a+7],10,1126891415),h=s(h,g,f,p,t[a+14],15,-1416354905),p=s(p,h,g,f,t[a+5],21,-57434055),f=s(f,p,h,g,t[a+12],6,1700485571),g=s(g,f,p,h,t[a+3],10,-1894986606),h=s(h,g,f,p,t[a+10],15,-1051523),p=s(p,h,g,f,t[a+1],21,-2054922799),f=s(f,p,h,g,t[a+8],6,1873313359),g=s(g,f,p,h,t[a+15],10,-30611744),h=s(h,g,f,p,t[a+6],15,-1560198380),p=s(p,h,g,f,t[a+13],21,1309151649),f=s(f,p,h,g,t[a+4],6,-145523070),g=s(g,f,p,h,t[a+11],10,-1120210379),h=s(h,g,f,p,t[a+2],15,718787259),p=s(p,h,g,f,t[a+9],21,-343485551),f=e(f,l),p=e(p,c),h=e(h,u),g=e(g,d);return[f,p,h,g]}function c(t){var e,n="";for(e=0;e<32*t.length;e+=8)n+=String.fromCharCode(t[e>>5]>>>e%32&255);return n}function u(t){var e,n=[];for(n[(t.length>>2)-1]=void 0,e=0;e<n.length;e+=1)n[e]=0;for(e=0;e<8*t.length;e+=8)n[e>>5]|=(255&t.charCodeAt(e/8))<<e%32;return n}function d(t){return c(l(u(t),8*t.length))}function f(t,e){var n,a,r=u(t),i=[],o=[];for(i[15]=o[15]=void 0,r.length>16&&(r=l(r,8*t.length)),n=0;16>n;n+=1)i[n]=909522486^r[n],o[n]=1549556828^r[n];return a=l(i.concat(u(e)),512+8*e.length),c(l(o.concat(a),640))}function p(t){var e,n,a="0123456789abcdef",r="";for(n=0;n<t.length;n+=1)e=t.charCodeAt(n),r+=a.charAt(e>>>4&15)+a.charAt(15&e);return r}function h(t){return unescape(encodeURIComponent(t))}function g(t){return d(h(t))}function v(t){return p(g(t))}function m(t,e){return f(h(t),h(e))}function b(t,e){return p(m(t,e))}function k(t,e,n){return e?n?m(e,t):b(e,t):n?g(t):v(t)}"function"==typeof define&&define.amd?define(function(){return k}):t.md5=k}(this);